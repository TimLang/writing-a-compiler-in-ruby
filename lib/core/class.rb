
def __new_class_object(size)
  ob = malloc(size)
  i = 1
#  %s(printf "class object: %p (%d bytes) / Class: %p" ob size Class)
#  %s(puts "")
  %s(while (lt i size) (do
       (assign (index ob i) __method_missing)
       (assign i (add i 1))
  ))
  %s(assign (index ob 0) Class)
  ob
end

class Class

  def new
    # @instance_size is generated by the compiler. YES, it is meant to be
    # an instance var, not a class var
    size = @instance_size
    %s(assign size (mul size 4))
    %s(assign ob (malloc size))
    %s(assign (index ob 0) self)
    %s(callm ob initialize ())
    ob
  end

  def attr_accessor sym
    %s(printf "attr_accessor %d" sym)
    %s(puts "")
  end
  
  def attr_reader sym
  end

  def attr_writer sym
  end
end

